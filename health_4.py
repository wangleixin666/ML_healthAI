# coding:utf-8
# 删除掉一些出现次数低，缺失比例大的字段，保留超过阈值的特征
import pandas as pd


def remain_feat(df, thresh):
    exclude_feats = []
    print('----------移除数据缺失多的字段-----------')
    print('移除之前总的字段数量',len(df.columns))
    num_rows = df.shape[0]
    for c in df.columns:
        num_missing = df[c].isnull().sum()
        if num_missing == 0:
            continue
        missing_percent = num_missing / float(num_rows)
        if missing_percent > thresh:
            exclude_feats.append(c)
    print(u"移除缺失数据的字段数量: %s" % len(exclude_feats))
    # 保留超过阈值的特征
    feats = []
    for c in df.columns:
        if c not in exclude_feats:
            feats.append(c)
    print(u'剩余的字段数量',len(feats))
    return feats


train_data = pd.read_csv(r'D:/kaggle/health/temp_data/train_other.csv')
feature = remain_feat(train_data, thresh=0.999)
# 一共有40000行，出现200次以上吧，也就是0.005省去，出现几率大于0.995的特征228个
# 出现400次以上的0.99，只剩下了174个特征，除去5个label，1个vid，还剩下169个特征
# 0.992 190-6=184

print feature

train_data_delted = train_data[feature]
train_data_delted.to_csv(r'D:/kaggle/health/temp_data/train_other_deleted.csv', index=False, sep=',', encoding='utf-8')

"""
0.99
['004997', '0105', '0106', '0107', '0108', '0109', '0111', '0112', '019001', '019002', 
'019003', '019017', '069002', '069003', '069004', '100005', '100007', '10012', '1124', 
'1125', '131', '1343', '1349', '137', '1456', '184', '21A002', '269028', '269029', '269030', 
'269031', '279001', '279002', '279003', '279005', '279006', '300006', '300007', '300069', '300070', 
'300087', '300119', '300129', '300136', '31', '310', '311', '315', '316', '317', '3184', '319', '319100', 
'33', '339125', '339126', '339128', '339129', '339130', '339131', '34', '35', '36', '369108', '37', '39', 
'459154', '459155', '459156', '459158', '459159', '459161', '459206', '459207', '459211', '669001', '669004', 
'669005', '699009', '709004', '709013', '709016', '709019', '709020', '709022', '709023', '709024', '709025', 
'709043', '809004', '809005', '809006', '809007', '809008', '809009', '809010', '809011', '809012', '809013', 
'809014', '809015', '809016', '809017', '809018', '809019', '809020', '809022', '809023', '809026', '809027', 
'809028', '809029', '809030', '809031', '809032', '809033', '809034', '809035', '809037', '809038', '809039', 
'809040', '809041', '809042', '809043', '809044', '809045', '809046', '809047', '809048', '809049', '809050', 
'809051', '809053', '809054', '809055', '809056', '809057', '809058', '809059', '809060', '809061', '819008', 
'819009', '819010', '819011', '819012', '819013', '819014', '819015', '819016', '819017', '819019', '819020', 
'819021', '819022', '819023', '819024', '819025', '819026', '819027', '819028', '819029', '979010', '979024', 
'979025', '979026', '979027']

0.999
['004997', '0105', '0106', '0107', '0108', '0109', '0111', '0112', '019001', '019002', '019003', '019004', '019007', 
'019008', '019017', '019032', '019033', '019034', '019035', '019036', '019037', '019038', '019039', '019040', '019041', 
'019042', '019043', '019044', '019045', '019046', '019047', '019048', '019049', '019050', '019051', '019052', '019053', 
'019054', '019055', '019056', '019059', '019062', '069002', '069003', '069004', '069005', '069007', '069008', '069010', 
'069023', '069044', '069049', '069050', '1', '10000', '100005', '100007', '10005', '10012', '10014', '1123', '1124', 
'1125', '1136', '129056', '129057', '129058', '129079', '131', '134', '1343', '1346', '1349', '1359', '137', '1456', 
'1461', '1471', '159053', '159063', '179176', '179177', '179178', '179226', '1816', '184', '1849', '186', '1915', 
'1918', '199118', '20000', '21A002', '21A012', '21A021', '229080', '2392', '2451', '2452', '2453', '2454', '269028', 
'269029', '269030', '269031', '269052', '269055', '269056', '269057', '269058', '279001', '279002', '279003', '279004', 
'279005', '279006', '279028', '299168', '300003', '300006', '300007', '300015', '300022', '300037', '300038', '300039', 
'300069', '300070', '300072', '300075', '300077', '300080', '300087', '300111', '300114', '300117', '300118', '300119', 
'300129', '300136', '300146', '300166', '300168', '300169', '300170', '300171', '300172', '300174', '300175', '300176', 
'300178', '300179', '300180', '300181', '300182', '300183', '300184', '300185', '300186', '300187', '300188', '300189', 
'300190', '31', '310', '311', '315', '316', '317', '3184', '319', '319100', '319159', '319273', '3205', '3206', '3211', 
'3217', '33', '3302', '339105', '339106', '339107', '339114', '339122', '339125', '339126', '339128', '339129', '339130', 
'339131', '339135', '34', '346', '35', '36', '369007', '369008', '369085', '369098', '369108', '37', '378', '3814', 
'3816', '3818', '39', '419008', '439011', '439015', '439016', '439035', '459116', '459117', '459141', '459154', '459155', 
'459156', '459158', '459159', '459161', '459181', '459182', '459183', '459184', '459206', '459207', '459208', '459209', 
'459211', '459327', '459329', '459330', '459331', '459332', '459333', '459336', '459337', '459338', '459340', '459342', 
'509006', '509013', '539004', '559007', '559046', '559047', '669001', '669004', '669005', '669010', '669014', '669043', 
'669044', '669045', '669046', '699001', '699003', '699004', '699005', '699006', '699009', '709004', '709013', '709016', 
'709019', '709020', '709022', '709023', '709024', '709025', '709027', '709030', '709031', '709043', '709044', '709048', 
'729028', '739005', '759001', '769008', '769019', '809004', '809005', '809006', '809007', '809008', '809009', '809010', 
'809011', '809012', '809013', '809014', '809015', '809016', '809017', '809018', '809019', '809020', '809022', '809023', 
'809026', '809027', '809028', '809029', '809030', '809031', '809032', '809033', '809034', '809035', '809036', '809037', 
'809038', '809039', '809040', '809041', '809042', '809043', '809044', '809045', '809046', '809047', '809048', '809049', 
'809050', '809051', '809053', '809054', '809055', '809056', '809057', '809058', '809059', '809060', '809061', '819006', 
'819008', '819009', '819010', '819011', '819012', '819013', '819014', '819015', '819016', '819017', '819019', '819020', 
'819021', '819022', '819023', '819024', '819025', '819026', '819027', '819028', '819029', '819030', '819031', '839018', 
'899021', '899022', '909001', '979010', '979024', '979025', '979026', '979027', '979029', '979091', '979092', '979093', 
'979094', '979095', '979096', '989001', '989002', '989003', '989043', '989065', 'A49018', 'C19103', 'C39002', 'D29008', 
'D29009', 'D29010', 'D29011', 'G49050', 'I19027', 'I69003', 'I69004', 'I69005', 'J29018', 'K29002', 'L19008', 'P19033', 
'P79002', 'Q99001', 'Q99002', 'T99001', 'T99002', 'U99009', 'X19001', 'X19002', 'X19003', 'X19011', 'Y79001']

"""